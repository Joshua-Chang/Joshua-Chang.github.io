
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>简析事件分发机制 | Joshua-Chang`Blog</title>
<meta name="description" content="温故而知新">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://Joshua-Chang.github.io/favicon.ico?v=1615445528605">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://Joshua-Chang.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://Joshua-Chang.github.io">
        <img class="avatar" src="https://Joshua-Chang.github.io/images/avatar.png?v=1615445528605" alt="" width="32px" height="32px">
      </a>
      <a href="https://Joshua-Chang.github.io">
        <h1 class="site-title">Joshua-Chang`Blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">简析事件分发机制</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2017-03-10</span>
            
          </div>
          <div class="post-content">
            <p>一、View的事件分发。<br>
结论：</p>
<p>1.控件的Listener事件触发的顺序是先onTouch，再onClick。<br>
2.控件的onTouch返回true，将会onClick事件没有了---阻止了事件的传递。<br>
返回false，才会传递onClick事件(才会传递up事件)</p>
<p>源码依据：</p>
<!--more-->
<p>​	View的事件分发<br>
​	1.dispatchTouchEvent（）<br>
​	2.onTouchListener--&gt;onTouch方法<br>
​	3.onTouchEvent()<br>
​	4.onClickListener--&gt;onClick方法</p>
<p>结论：<br>
1.如果onTouchListener的onTouch方法返回了true，那么view里面的onTouchEvent就不会被调用了。<br>
顺序dispatchTouchEvent--&gt;onTouchListener---return false--&gt;onTouchEvent<br>
2.如果view为disenable,则：onTouchListener里面不会执行，但是会执行onTouchEvent(event)方法<br>
3.onTouchEvent方法中的ACTION_UP分支中触发onclick事件监听<br>
onTouchListener--&gt;onTouch方法返回true，消耗次事件。down,但是up事件是无法到达onClickListener.<br>
onTouchListener--&gt;onTouch方法返回false，不会消耗此事件</p>
<p>二、ViewGroup+View的事件分发<br>
ViewGroup--&gt;View<br>
​	1.dispatchTouchEvent()<br>
​	2.onTouchEvent();<br>
​	3.onInterceptTouchEvent(); 拦截触摸事件。</p>
<p>1.先接触到事件的是父容器。<br>
2.顺序：dispatchTouchEvent--&gt;onInterceptTouchEvent-----&gt;onTouchListener---return false--&gt;onTouchEvent</p>
<p>dispatchTouchEvent:action--0---view:MyRelativeLayout<br>
onInterceptTouchEvent:action--0---view:MyRelativeLayout //false不拦截<br>
​	super.dispatchTouchEvent()<br>
​	child.dispatchTouchEvent()<br>
dispatchTouchEvent:action--0---view:MyButton<br>
OnTouchListener:acton--0----view:com.ricky.event.MyButton{528154dc VFED..C. ........ 0,37-205,163 #7f080001 app:id/button1}<br>
onTouchEvent:action--0---view:MyButton</p>
<p>源码：2108行<br>
​	 final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;<br>
​	            if (!disallowIntercept) {<br>
​	                intercepted = onInterceptTouchEvent(ev);//调用拦截方法判断<br>
​	                ev.setAction(action); // restore action in case it was changed<br>
​	            } else {<br>
​	                intercepted = false;<br>
​	            }<br>
源码：2197行<br>
​	 if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {</p>
<p>源码：2520行<br>
​	dispatchTransformedTouchEvent(){<br>
​		 if (child == null) {//如果ViewGroup里面没有子控件就交给自己处理(就是一个纯粹的View)<br>
​			handled = super.dispatchTouchEvent(event);<br>
​		    } else {<br>
​			handled = child.dispatchTouchEvent(event);<br>
​		    }<br>
​	}</p>

          </div>
        </div>

        
      </div>

      

      <div class="site-footer">
  <div class="slogan">温故而知新</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
   | <a class="rss" href="https://Joshua-Chang.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
